//|     Motor assistance calculator
//|
//|     Authors: Ben Smith
//|
//|     This module will take in the cadence, heart rate, wheel speed, and IMU data to calculate the required
//|     motor thrust to assist the rider.
//|
//|
`timescale 10 ns / 1 ns

module AssistanceAlgorithm(
    input  	wire                		clk,

    //| IMU Inputs 	
	 input 	wire	signed 	[9:0] 	resolvedAngle,
	 
	 //| Biometric Inputs
    //input  	wire				[7:0]		HeartRate,
	 input  	wire				[7:0]		HeartRateCap,
	 
    //| Motor output
    output 	reg   signed      [7:0]        		PWMOut
    );
		
		 AccelSettingtReadback  pwmout (
    .probe (PWMOut),
	 .source(HeartRate)
    );
	//For testing only
	
		 	reg				[7:0]		HeartRate;
    //|
    //| Local reg/wire declarations
    //|--------------------------------------------
		reg signed 	[9:0]	Angle;
		reg signed	[7:0]	offset;
		
		assign Angle = resolvedAngle;
		assign Heart = HeartRate;
		assign offset = (HeartRate - HeartRateCap);

    //| State machine control
    //|--------------------------------------------


    //|
    //| Structual Coding
    //|--------------------------------------------
	 
	 always @ (posedge clk)
        begin
				if(offset > 0)	PWMOut = Angle + offset;
				else PWMOut = Angle;
				
				if (PWMOut < 0) PWMOut = 0; 
        end
endmodule